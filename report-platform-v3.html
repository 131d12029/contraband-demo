<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>違禁商品通報平台 v2.2</title>
<!-- 修正 Icon 顯示：採用 FA 6.5.1 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<!-- 統計圖表插件 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<style>
  :root {
    --navy: #0a1628; --navy-mid: #112240; --navy-light: #1a3160;
    --amber: #f5a623; --amber-light: #ffd280; --red: #e84545;
    --green: #2dce89; --orange: #fb6340; --gray-muted: #8892a4;
    --gray-border: #1e3050; --white: #ffffff;
    --text-primary: #e8edf5; --text-secondary: #8892a4;
    --card-bg: #112240; --input-bg: #0d1e38; --radius: 12px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Noto Sans TC', sans-serif; background: var(--navy); color: var(--text-primary); padding-bottom: 80px; }

  /* ─── NAVBAR ─── */
  .navbar {
    background: var(--navy-mid); border-bottom: 1px solid var(--gray-border);
    padding: 0 24px; height: 64px; display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100; backdrop-filter: blur(8px);
  }
  .navbar-brand { display: flex; align-items: center; gap: 10px; text-decoration: none; }
  .brand-icon { width: 36px; height: 36px; background: var(--amber); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--navy); font-size: 18px; }
  .brand-text { font-weight: 900; color: var(--white); font-size: 16px; line-height: 1.2; }
  .nav-links { display: flex; list-style: none; gap: 8px; }
  .nav-links a { padding: 8px 16px; border-radius: 8px; text-decoration: none; color: var(--text-secondary); font-size: 14px; cursor: pointer; transition: 0.2s; }
  .nav-links a:hover { color: var(--white); background: var(--navy-light); }
  .nav-links a.active { color: var(--amber); background: rgba(245,166,35,0.1); }

  /* ─── PAGES ─── */
  .page { display: none; animation: fadeIn 0.3s ease; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
  .container { max-width: 1000px; margin: 0 auto; padding: 32px 24px; }
  .page-header { margin-bottom: 32px; }
  .page-header h1 { font-size: 28px; font-weight: 900; }
  .card { background: var(--card-bg); border: 1px solid var(--gray-border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }

  /* ─── FORM ─── */
  .step-indicator { display: flex; align-items: center; margin-bottom: 32px; }
  .step { display: flex; align-items: center; gap: 10px; flex: 1; }
  .step-num { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: var(--navy-light); border: 2px solid var(--gray-border); font-size: 12px; }
  .step.active .step-num { background: var(--amber); color: var(--navy); border-color: var(--amber); }
  .step.done .step-num { background: var(--green); color: white; border-color: var(--green); }
  .step-line { flex: 1; height: 2px; background: var(--gray-border); margin: 0 15px; }

  .form-section { display: none; }
  .form-section.active { display: block; }
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .form-group { display: flex; flex-direction: column; gap: 8px; }
  .full { grid-column: 1 / -1; }
  label { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
  .required { color: var(--red); }
  input, select, textarea { background: var(--input-bg); border: 1px solid var(--gray-border); border-radius: 8px; padding: 12px; color: white; outline: none; }
  input:focus { border-color: var(--amber); }

  /* ─── UPLOAD & PREVIEW ─── */
  .upload-area { border: 2px dashed var(--gray-border); padding: 30px; text-align: center; cursor: pointer; border-radius: 12px; }
  .preview-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
  .preview-item { position: relative; width: 80px; height: 80px; cursor: zoom-in; }
  .preview-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 1px solid var(--gray-border); }
  .preview-delete { position: absolute; top: -5px; right: -5px; background: var(--red); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 10px; z-index: 5; }

  /* ─── LIGHTBOX ─── */
  #lightbox { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; z-index:2000; cursor:zoom-out; }
  #lightbox img { max-width:90%; max-height:90%; border-radius:8px; }

  /* ─── STATUS BADGE ─── */
  .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; }
  .status-done { background: rgba(45,206,137,0.15); color: var(--green); }
  .status-reviewing { background: rgba(251,99,64,0.15); color: var(--orange); }
  .status-pending { background: rgba(138,145,162,0.15); color: #8a91a2; }

  /* ─── HISTORY RECORD ─── */
  .record-card { background: var(--navy-mid); border: 1px solid var(--gray-border); padding: 16px; border-radius: 12px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
  .record-info { display: flex; align-items: center; gap: 15px; }
  .plat-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 12px; }

  /* ─── STATS ─── */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
  .stat-card { background: var(--navy-mid); padding: 20px; border-radius: 12px; border: 1px solid var(--gray-border); border-top: 3px solid var(--amber); }
  .chart-container { height: 250px; margin-top: 15px; }

  /* ─── FILTER ─── */
  .filter-btn { background: var(--input-bg); border: 1px solid var(--gray-border); color: var(--text-secondary); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; transition: 0.2s; }
  .filter-btn:hover { color: white; border-color: var(--amber); }
  .filter-btn.active { background: rgba(245,166,35,0.15); color: var(--amber); border-color: var(--amber); }

  /* RWD */
  @media (max-width: 768px) {
    .form-grid, .stats-grid { grid-template-columns: 1fr; }
    .nav-links { display: none; }
  }
</style>
</head>
<body>

<div id="lightbox" onclick="this.style.display='none'"><img id="lightbox-img" src=""></div>

<nav class="navbar">
  <a class="navbar-brand" href="#">
    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
    <div><div class="brand-text">違禁商品通報平台</div></div>
  </a>
  <ul class="nav-links">
    <li><a onclick="showPage('report')" id="nav-report" class="active">立即通報</a></li>
    <li><a onclick="showPage('history')" id="nav-history">通報紀錄</a></li>
    <li><a onclick="showPage('stats')" id="nav-stats">統計數據</a></li>
  </ul>
</nav>

<!-- ══════════ PAGE: REPORT ══════════ -->
<div id="page-report" class="page active">
  <div class="container">
    <div class="page-header">
      <h1>通報違禁商品</h1>
      <p style="color:var(--text-secondary)">發現網路平台販售禁售商品？請填寫以下資訊協助調查。</p>
    </div>

    <div class="card">
      <div class="step-indicator">
        <div class="step active" id="step1-indicator"><div class="step-num">1</div><div style="font-size:12px; margin-left:8px">輸入資訊</div></div>
        <div class="step-line"></div>
        <div class="step" id="step2-indicator"><div class="step-num">2</div><div style="font-size:12px; margin-left:8px">確認送出</div></div>
      </div>

      <div class="form-section active" id="form-step1">
        <div class="form-grid">
          <div class="form-group full">
            <label><i class="fas fa-link"></i> 商品頁面網址 <span class="required">*</span></label>
            <input type="url" id="product-url" placeholder="請貼上連結 (例: https://shopee.tw/...)" oninput="detectPlatform(this.value)">
          </div>
          <div class="form-group">
            <label><i class="fas fa-store"></i> 電商平台 <span class="required">*</span></label>
            <select id="platform-select">
              <option value="">請選擇平台</option>
              <option value="shopee">蝦皮購物 Shopee</option>
              <option value="momo">momo 購物網</option>
              <option value="pchome">PChome 24h</option>
              <option value="ruten">露天市集</option>
              <option value="yahoo">Yahoo 購物</option>
              <option value="other">其他</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-user-tag"></i> 賣家名稱 <span class="required">*</span></label>
            <input type="text" id="seller-id" placeholder="請輸入賣家帳號或名稱">
          </div>
          <div class="form-group full">
            <label><i class="fas fa-tag"></i> 商品名稱 <span class="required">*</span></label>
            <input type="text" id="product-name" placeholder="請輸入完整的商品名稱">
          </div>
          <div class="form-group full">
            <label><i class="fas fa-image"></i> 佐證截圖 (最多3張，點擊可放大)</label>
            <div class="upload-area" onclick="document.getElementById('file-upload').click()">
              <i class="fas fa-cloud-upload-alt" style="font-size:24px; color:var(--amber); margin-bottom:8px"></i>
              <p style="font-size:13px">點擊或拖曳上傳圖片</p>
            </div>
            <input type="file" id="file-upload" accept="image/*" multiple style="display:none" onchange="previewFiles(this)">
            <div class="preview-container" id="preview-container"></div>
          </div>

        </div>
        <div style="margin-top:25px; text-align:right">
          <button class="btn-primary" style="padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:700" onclick="goStep2()">下一步 <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>

      <div class="form-section" id="form-step2">
        <div id="confirm-content" style="background:var(--input-bg); padding:20px; border-radius:8px; margin-bottom:20px; line-height:2"></div>
        <div style="text-align:right; gap:10px; display:flex; justify-content:flex-end">
          <button style="background:none; border:1px solid var(--gray-border); color:white; padding:10px 20px; border-radius:8px; cursor:pointer" onclick="goStep1()">返回修改</button>
          <button class="btn-primary" style="padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:700" onclick="submitReport()">確認送出通報</button>
        </div>
      </div>

      <div class="form-section" id="form-success" style="text-align:center; padding:30px">
        <i class="fas fa-check-circle" style="font-size:60px; color:var(--green)"></i>
        <h2 style="margin:20px 0 10px">通報已送出</h2>
        <p style="color:var(--text-secondary); margin-bottom:25px">案號：<span id="new-id" style="color:var(--amber); font-weight:700"></span></p>
        <button class="btn-primary" style="padding:12px 30px; border:none; border-radius:8px; cursor:pointer" onclick="location.reload()">回到通報首頁</button>
      </div>
    </div>
  </div>
</div>

<!-- ══════════ PAGE: HISTORY ══════════ -->
<div id="page-history" class="page">
  <div class="container">
    <div class="page-header">
      <h1>通報紀錄歷史</h1>
    </div>
    <div class="card" style="margin-bottom:20px">
      <label style="margin-bottom:12px"><i class="fas fa-filter"></i> 篩選狀態</label>
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <button class="filter-btn active" data-filter="all" onclick="filterRecords('all')">全部</button>
        <button class="filter-btn" data-filter="done" onclick="filterRecords('done')">已完成</button>
        <button class="filter-btn" data-filter="reviewing" onclick="filterRecords('reviewing')">審核中</button>
      </div>
    </div>
    <div id="records-list"></div>
  </div>
</div>

<!-- ══════════ PAGE: STATS ══════════ -->
<div id="page-stats" class="page">
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card"><div>總通報數</div><div id="stat-total" style="font-size:28px; font-weight:900; color:var(--amber)">0</div></div>
      <div class="stat-card" style="border-top-color:var(--green)"><div>已完成</div><div id="stat-done" style="font-size:28px; font-weight:900; color:var(--green)">0</div></div>
      <div class="stat-card" style="border-top-color:var(--orange)"><div>處理中</div><div id="stat-review" style="font-size:28px; font-weight:900; color:var(--orange)">0</div></div>
      <div class="stat-card"><div>處理率</div><div id="stat-rate" style="font-size:28px; font-weight:900">0%</div></div>
    </div>
    <div class="form-grid">
      <div class="card"><strong>每月趨勢</strong><div class="chart-container"><canvas id="trendChart"></canvas></div></div>
      <div class="card"><strong>平台分佈</strong><div class="chart-container"><canvas id="platformChart"></canvas></div></div>
    </div>
  </div>
</div>

<script>
// 1. 復原模擬資料
const BASE_RECORDS = [
  { id:"RPT-2024-0020", platform:"蝦皮購物", key:"shopee", product:"快速瘦身減脂膠囊 XX牌", status:"done", date:"2024-12-10", seller:"shopee_health99" },
  { id:"RPT-2024-0019", platform:"PChome", key:"pchome", product:"美國進口麻黃素飲品", status:"reviewing", date:"2024-12-09", seller:"PC_sports_shop" },
  { id:"RPT-2024-0018", platform:"momo", key:"momo", product:"LV 精品皮包（1:1高仿）", status:"done", date:"2024-12-08", seller:"momo_luxury88" },
  { id:"RPT-2024-0017", platform:"蝦皮購物", key:"shopee", product:"含塑化劑兒童積木組", status:"pending", date:"2024-12-07", seller:"toy_world_tw" },
  { id:"RPT-2024-0016", platform:"露天市集", key:"ruten", product:"含禁用色素食用染料", status:"done", date:"2024-12-05", seller:"ruten_food_store" },
  { id:"RPT-2024-0015", platform:"Yahoo 購物", key:"yahoo", product:"強效安眠藥（無處方）", status:"reviewing", date:"2024-12-04", seller:"yahoo_medi_shop" },
  { id:"RPT-2024-0014", platform:"蝦皮購物", key:"shopee", product:"韓國代購 BTS 周邊", status:"pending", date:"2024-12-03", seller:"kpop_store_tw" },
  { id:"RPT-2024-0013", platform:"momo", key:"momo", product:"未申請核准電磁爐", status:"done", date:"2024-12-01", seller:"momo_kitchen_life" },
  { id:"RPT-2024-0012", platform:"蝦皮購物", key:"shopee", product:"壯陽保健膠囊", status:"done", date:"2024-11-28", seller:"shop_natural88" },
  { id:"RPT-2024-0011", platform:"PChome", key:"pchome", product:"未獲認證安全帽", status:"pending", date:"2024-11-26", seller:"pc_moto_parts" },
  { id:"RPT-2024-0010", platform:"露天市集", key:"ruten", product:"未核准皮膚美白針", status:"reviewing", date:"2024-11-25", seller:"beauty_ruten_shop" },
  { id:"RPT-2024-0009", platform:"蝦皮購物", key:"shopee", product:"Nike 球鞋（高仿版）", status:"done", date:"2024-11-22", seller:"shoe_king_tw" },
  { id:"RPT-2024-0008", platform:"Yahoo 購物", key:"yahoo", product:"含砷美白面膜", status:"done", date:"2024-11-20", seller:"yahoo_beauty_care" },
  { id:"RPT-2024-0007", platform:"momo", key:"momo", product:"瘦臉神器（高頻電流）", status:"reviewing", date:"2024-11-18", seller:"momo_beauty_device" },
  { id:"RPT-2024-0006", platform:"蝦皮購物", key:"shopee", product:"含美沙冬保健品", status:"done", date:"2024-11-15", seller:"health_boost_tw" },
  { id:"RPT-2024-0005", platform:"PChome", key:"pchome", product:"未申報無人機", status:"pending", date:"2024-11-12", seller:"pc_drone_shop" },
  { id:"RPT-2024-0004", platform:"露天市集", key:"ruten", product:"大麻二酚 CBD 軟糖", status:"done", date:"2024-11-10", seller:"ruten_natural_store" },
  { id:"RPT-2024-0003", platform:"蝦皮購物", key:"shopee", product:"萬聖節面具（螢光劑）", status:"done", date:"2024-11-08", seller:"shop_halloween_tw" },
  { id:"RPT-2024-0002", platform:"momo", key:"momo", product:"未授權動漫周邊", status:"done", date:"2024-11-05", seller:"momo_anime_shop" },
  { id:"RPT-2024-0001", platform:"蝦皮購物", key:"shopee", product:"含塑化劑嬰兒奶嘴", status:"done", date:"2024-11-01", seller:"baby_safe_shop" }
];

const PLATFORM_MAP = {
  shopee: { name:"蝦皮", color:"#ee4d2d" },
  momo: { name:"momo", color:"#d5004b" },
  pchome: { name:"PCH", color:"#c00" },
  ruten: { name:"露天", color:"#0055a5" },
  yahoo: { name:"Yahoo", color:"#7b0099" },
  other: { name:"其他", color:"#555" }
};

let records = [...BASE_RECORDS];

// 2. 顯示頁面
function showPage(p) {
  document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  document.querySelectorAll('.nav-links a').forEach(el => el.classList.remove('active'));
  document.getElementById('nav-'+p).classList.add('active');
  
  if(p === 'history') renderHistory();
  if(p === 'stats') { updateStats(); initCharts(); }
}

// 3. 自動偵測平台
function detectPlatform(url) {
  const select = document.getElementById('platform-select');
  if(url.includes('shopee.tw')) select.value = 'shopee';
  else if(url.includes('momoshop.com.tw')) select.value = 'momo';
  else if(url.includes('pchome.com.tw')) select.value = 'pchome';
  else if(url.includes('ruten.com.tw')) select.value = 'ruten';
  else if(url.includes('yahoo.com')) select.value = 'yahoo';
}

// 4. 圖片處理與放大
let uploadedFiles = [];
function previewFiles(input) {
  const newFiles = Array.from(input.files);
  const remaining = 3 - uploadedFiles.length;
  uploadedFiles = [...uploadedFiles, ...newFiles.slice(0, remaining)];
  
  const container = document.getElementById('preview-container');
  container.innerHTML = '';
  uploadedFiles.forEach((file, idx) => {
    const reader = new FileReader();
    reader.onload = e => {
      const div = document.createElement('div');
      div.className = 'preview-item';
      div.onclick = () => {
        document.getElementById('lightbox-img').src = e.target.result;
        document.getElementById('lightbox').style.display = 'flex';
      };
      div.innerHTML = `<img src="${e.target.result}"><button class="preview-delete" onclick="event.stopPropagation(); removeImg(${idx})">×</button>`;
      container.appendChild(div);
    };
    reader.readAsDataURL(file);
  });
}
function removeImg(idx) {
  uploadedFiles.splice(idx, 1);
  const input = document.getElementById('file-upload');
  previewFiles(input);
}

// 5. 表單邏輯 (賣家必填)
function goStep2() {
  const url = document.getElementById('product-url').value;
  const seller = document.getElementById('seller-id').value;
  const name = document.getElementById('product-name').value;
  const plat = document.getElementById('platform-select').value;

  if(!url || !seller || !name || !plat) {
    alert("請完整填寫必填資訊 (*)");
    return;
  }

  document.getElementById('confirm-content').innerHTML = `
    <strong>平台：</strong> ${PLATFORM_MAP[plat].name}<br>
    <strong>賣家：</strong> ${seller}<br>
    <strong>商品：</strong> ${name}<br>
    <strong>截圖：</strong> ${uploadedFiles.length} 張
  `;
  document.getElementById('form-step1').classList.remove('active');
  document.getElementById('form-step2').classList.add('active');
  document.getElementById('step1-indicator').classList.add('done');
  document.getElementById('step2-indicator').classList.add('active');
}

function goStep1() {
  document.getElementById('form-step1').classList.add('active');
  document.getElementById('form-step2').classList.remove('active');
  document.getElementById('step1-indicator').classList.remove('done');
  document.getElementById('step2-indicator').classList.remove('active');
}

function submitReport() {
  const newId = "RPT-2025-" + Math.floor(1000 + Math.random() * 9000);
  const platKey = document.getElementById('platform-select').value;
  const newRecord = {
    id: newId,
    platform: PLATFORM_MAP[platKey].name,
    key: platKey,
    product: document.getElementById('product-name').value,
    status: "pending",
    date: new Date().toISOString().slice(0, 10),
    seller: document.getElementById('seller-id').value
  };
  records.unshift(newRecord);
  document.getElementById('new-id').textContent = newId;
  document.getElementById('form-step2').classList.remove('active');
  document.getElementById('form-success').classList.add('active');
}

// 6. 渲染歷史紀錄
let currentFilter = 'all';
function renderHistory() {
  const list = document.getElementById('records-list');
  const filtered = currentFilter === 'all' ? records : records.filter(r => r.status === currentFilter);
  list.innerHTML = filtered.map(r => `
    <div class="record-card">
      <div class="record-info">
        <div class="plat-icon" style="background:${PLATFORM_MAP[r.key]?.color || '#555'}; color:white">${PLATFORM_MAP[r.key]?.name[0]}</div>
        <div>
          <div style="font-weight:700; font-size:14px">${r.product}</div>
          <div style="font-size:11px; color:var(--text-secondary)">${r.id} | 賣家: ${r.seller} | ${r.date}</div>
        </div>
      </div>
      <div class="status-badge status-${r.status}">${r.status === 'done' ? '已完成' : r.status === 'reviewing' ? '審核中' : '待處理'}</div>
    </div>
  `).join('');
}

function filterRecords(filter) {
  currentFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
  renderHistory();
}

// 7. 統計與圖表
function updateStats() {
  document.getElementById('stat-total').textContent = records.length;
  const done = records.filter(r => r.status === 'done').length;
  document.getElementById('stat-done').textContent = done;
  document.getElementById('stat-review').textContent = records.filter(r => r.status === 'reviewing').length;
  document.getElementById('stat-rate').textContent = Math.round((done / records.length) * 100) + "%";
}

let charts = {};
function initCharts() {
  if (charts.trend) charts.trend.destroy();
  if (charts.plat) charts.plat.destroy();

  charts.trend = new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: ['10月', '11月', '12月', '1月'],
      datasets: [{ label: '通報數', data: [12, 15, 8, records.length - 35], borderColor: '#f5a623', tension: 0.3 }]
    },
    options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
  });

  const platCounts = {};
  records.forEach(r => platCounts[r.platform] = (platCounts[r.platform] || 0) + 1);

  charts.plat = new Chart(document.getElementById('platformChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(platCounts),
      datasets: [{ data: Object.values(platCounts), backgroundColor: ['#ee4d2d', '#d5004b', '#c00', '#0055a5', '#7b0099'] }]
    },
    options: { maintainAspectRatio: false, cutout: '70%' }
  });
}

// 初始化渲染一次
renderHistory();
</script>
</body>
</html>
